<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Faire part Charl√®ne et Quentin</title>
    <link href="https://fonts.googleapis.com/css2?family=Meow+Script&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Tailwind custom configuration
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              meow: ['"Meow Script"', "cursive"],
              futura: ["Futura", "Arial", "sans-serif"],
            },
            keyframes: {
              "slide-down-out": {
                "0%": { transform: "translateY(0)" },
                "100%": { transform: "translateY(900px)" },
              },
            },
            animation: {
              "slide-down-out": "slide-down-out 1.1s cubic-bezier(.77,0,.18,1) forwards",
            },
          },
        },
      };
    </script>
    <style>
      @keyframes flap-slide-down {
        0% {
          transform: rotateX(-140deg) translateY(0);
        }
        100% {
          transform: rotateX(-140deg) translateY(-1100px);
        }
      }
      .flap.flap-slide-down {
        animation: flap-slide-down 1s cubic-bezier(0.77, 0, 0.18, 1) forwards;
      }
    </style>
  </head>
  <body
    class="min-h-screen flex items-center justify-center bg-[#f5f0eb] bg-center bg-no-repeat bg-cover"
    style="background-image: url('./background.png')"
  >
    <div class="fixed inset-0 pointer-events-none z-50 petals-container" aria-hidden="true"></div>
    <div class="fixed inset-0 pointer-events-none z-[60] confetti-container" aria-hidden="true"></div>
    <div class="container flex items-center justify-center min-h-screen">
      <div
        class="envelope-container relative flex flex-col items-center justify-center focus:outline-none"
        tabindex="0"
        aria-label="Ouvrir l'enveloppe d'invitation"
        role="button"
      >
        <div
          id="flap"
          class="flap absolute top-0 left-0 w-full h-[60px] rounded-t-[4px] z-50 shadow-[0_6px_16px_rgba(0,0,0,0.10)]"
          style="
            background: linear-gradient(180deg, #871521 80%, #921718 100%);
            transform-origin: top center;
            transform: rotateX(0deg);
            transition: transform 0.7s cubic-bezier(0.77, 0, 0.18, 1);
          "
        ></div>
        <div
          class="wrapper relative w-[95vw] max-w-[440px] h-[150vw] min-h-[540px] sm:w-[440px] sm:h-[700px] sm:min-h-0"
        >
          <div
            id="envelope"
            class="envelope flex items-center justify-center bg-[url('./enveloppe.png')] bg-cover bg-center relative w-[95vw] max-w-[440px] h-[150vw] min-h-[540px] sm:w-[440px] sm:h-[700px] sm:min-h-0 rounded-[4px] shadow-lg overflow-hidden z-50"
            aria-label="Enveloppe hongbao traditionnelle"
          >
            <div class="relative flex items-center justify-center w-full h-full">
              <div id="invitation-block" class="relative z-10 flex flex-col items-center justify-center w-full h-full">
                <div class="flex flex-col items-center justify-center">
                  <!-- Guests card -->
                  <div
                    class="bg-white rounded-[15px] px-6 py-2 shadow font-meow text-[#CE412D] text-[30px] inline-block max-w-[322px]"
                    style="
                      display: inline-block;
                      transform: rotate(-2.88deg);
                      margin-top: 8px;
                      margin-bottom: 8px;
                      min-width: 80px;
                    "
                  >
                    <div class="text-[20px] sm:text-2xl font-bold tracking-wide mb-1 text-center w-full">Pour</div>
                    <div id="guests-list" class="w-auto text-[30px] break-words text-center"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center w-[95vw] max-w-[440px] h-[150vw] min-h-[540px] sm:w-[440px] sm:h-[700px] sm:min-h-0"
            style="z-index: 1; background: url('./invitation_background.png') center/cover no-repeat"
          >
            <!-- Main invitation card -->
            <div
              class="relative flex flex-col items-start bg-white rounded-[9px] shadow-lg px-4 pt-12 text-left w-[303px] h-[380px] sm:h-[431px]"
              style="z-index: 10"
            >
              <img
                src="ruban.svg"
                alt="Ruban d√©coratif"
                style="width: 303px; height: auto; position: absolute; top: -18px; left: 0; z-index: 20"
                draggable="false"
              />
              <h2
                class="font-meow text-[#CE412D]"
                style="
                  font-size: 42px;
                  transform: rotate(-2.76deg);
                  margin-top: 32px;
                  white-space: nowrap;
                  overflow: visible;
                  position: relative;
                  z-index: 30;
                "
              >
                Charl√®ne & Quentin
              </h2>
              <div class="text-[#871521] sm:text-[17px] text-[15px] font-futura leading-[1.2] sm:leading-normal">
                sont heureux de vous annoncer<br />
                leur mariage et vous convient √† c√©l√©brer ce moment unique √† leurs c√¥t√©s
              </div>
              <span
                class="leading-[1.2] sm:leading-normal block text-[#871521] font-futura text-[17px] select-none"
                aria-hidden="true"
              >
                - - - - -
              </span>
              <div class="leading-[1.2] sm:leading-normal text-[#871521] font-futura mb-2">
                <span style="font-size: 17px">üìÖ Rendez vous le</span><br />
                <b style="font-size: 15px">20 Septembre 2025 √† 19H00</b><br />
                <b style="font-size: 15px">√† CHINE MASSENA</b><br />
                <span style="font-size: 12.5px">13 Pl. de V√©n√©tie, 75013 Paris</span>
              </div>
              <div class="text-[#871521] text-[12px] font-futura">
                <a
                  href="#"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hover:text-[#CE412D] transition-colors duration-150 no-underline"
                  style="cursor: pointer; text-decoration: none"
                >
                  üéÅ Envie de faire plaisir sans se casser la t√™te ?<br />
                  √áa tombe bien : on a cr√©√© une cagnotte !
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      /**
       * Animation and invitation logic for the wedding envelope.
       * Handles petals, fireworks, envelope opening, and guest rendering.
       */

      // DOM Elements
      const envelopeContainer = document.querySelector(".envelope-container");
      const envelope = document.getElementById("envelope");
      const flap = document.getElementById("flap");
      const petalsContainer = document.querySelector(".petals-container");
      const confettiContainer = document.querySelector(".confetti-container");

      // State
      let isOpen = false;
      let isPetalLooping = false;

      // Petal Animation Constants
      const PETAL_COUNT = 24;
      const PETAL_COLORS = ["bg-pink-100", "bg-pink-200", "bg-rose-100"];

      // Firework Animation Constants
      const FIREWORK_BURST_COUNT = 10;
      const PARTICLES_PER_BURST = 16;
      const FIREWORK_COLORS = ["#fbbf24", "#e11d48", "#f472b6", "#38bdf8", "#34d399", "#f59e42"];

      /**
       * Returns a random item from an array.
       * @param {Array} arr
       * @returns {*}
       */
      const getRandomArrayItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

      /**
       * Creates a petal DOM element with random style.
       * @returns {HTMLDivElement}
       */
      const createPetalElement = () => {
        const colorClass = getRandomArrayItem(PETAL_COLORS);
        const rotate = Math.floor(Math.random() * 360);
        const scale = 0.6 + Math.random() * 0.3;
        const opacity = 0.5 + Math.random() * 0.3;
        const petal = document.createElement("div");
        petal.className = `absolute top-0 left-0 w-2 h-3 ${colorClass} rounded-full shadow pointer-events-none`;
        petal.style.opacity = opacity;
        petal.style.transform = `scale(${scale}) rotate(${rotate}deg)`;
        return petal;
      };

      /**
       * Animates a petal falling down the screen.
       * @param {HTMLDivElement} petal
       */
      const animatePetal = (petal) => {
        const startLeft = Math.random() * 100;
        const endLeft = startLeft + (Math.random() - 0.5) * 8;
        const duration = 3500 + Math.random() * 1500;
        const swayAmplitude = 5 + Math.random() * 6;
        const swayFrequency = 1 + Math.random() * 2;
        const rotateStart = Math.random() * 360;
        const rotateEnd = rotateStart + (Math.random() - 0.5) * 60;
        let startTime = null;
        const scale = petal.style.transform.match(/scale\(([^)]+)\)/)[1];

        const animate = (timestamp) => {
          if (!startTime) startTime = timestamp;
          const elapsed = timestamp - startTime;
          const progress = Math.min(elapsed / duration, 1);

          const top = progress * 105;
          const sway = Math.sin(progress * Math.PI * swayFrequency) * swayAmplitude;
          const left = startLeft + (endLeft - startLeft) * progress + (sway / window.innerWidth) * 100;
          const rotate = rotateStart + (rotateEnd - rotateStart) * progress;

          petal.style.top = `${top}vh`;
          petal.style.left = `${left}vw`;
          petal.style.transform = `scale(${scale}) rotate(${rotate}deg)`;

          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            petal.style.opacity = 0;
            setTimeout(() => petal.remove(), 200);
          }
        };

        requestAnimationFrame(animate);
      };

      /**
       * Launches a loop of falling petals.
       */
      const launchPetalsLoop = () => {
        if (!isPetalLooping) return;
        for (let i = 0; i < PETAL_COUNT; i++) {
          setTimeout(() => {
            const petal = createPetalElement();
            petalsContainer.appendChild(petal);
            animatePetal(petal);
          }, i * 60 + Math.random() * 40);
        }
        setTimeout(launchPetalsLoop, 2000);
      };

      /**
       * Creates a firework particle DOM element.
       * @param {string} color
       * @returns {HTMLDivElement}
       */
      const createFireworkParticle = (color) => {
        const size = 12 + Math.random() * 8;
        const div = document.createElement("div");
        div.className = "absolute pointer-events-none";
        div.style.width = `${size}px`;
        div.style.height = `${size}px`;
        div.innerHTML = `
        <svg viewBox="0 0 32 32" class="w-full h-full" aria-hidden="true">
          <circle cx="16" cy="16" r="7" fill="${color}" fill-opacity="0.85"/>
        </svg>
      `;
        return div;
      };

      /**
       * Launches the fireworks animation.
       */
      const launchFireworksAnimation = () => {
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        for (let b = 0; b < FIREWORK_BURST_COUNT; b++) {
          const burstX = 40 + Math.random() * (screenWidth - 80);
          const burstY = 0.1 * screenHeight + Math.random() * (0.2 * screenHeight);

          setTimeout(() => {
            for (let i = 0; i < PARTICLES_PER_BURST; i++) {
              const angle = (2 * Math.PI * i) / PARTICLES_PER_BURST;
              const distance = 80 + Math.random() * 60;
              const color = getRandomArrayItem(FIREWORK_COLORS);
              const particle = createFireworkParticle(color);

              particle.style.left = `${burstX}px`;
              particle.style.top = `${burstY}px`;
              confettiContainer.appendChild(particle);

              const finalX = burstX + Math.cos(angle) * distance;
              const finalY = burstY + Math.sin(angle) * distance;

              let startTime = null;
              const duration = 950 + Math.random() * 350;
              const rotate = Math.random() * 360;

              const animate = (timestamp) => {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1);

                const currentX = burstX + (finalX - burstX) * progress;
                const currentY = burstY + (finalY - burstY) * progress;
                particle.style.left = `${currentX}px`;
                particle.style.top = `${currentY}px`;
                particle.style.transform = `rotate(${rotate}deg) scale(${1 - 0.4 * progress})`;
                particle.style.opacity = 1 - progress;

                if (progress < 1) {
                  requestAnimationFrame(animate);
                } else {
                  particle.remove();
                }
              };
              requestAnimationFrame(animate);
            }
          }, b * 250 + Math.random() * 120);
        }
      };

      /**
       * Handles the opening of the envelope (animation, petals, fireworks).
       */
      const handleOpenEnvelope = () => {
        if (isOpen) return;
        envelopeContainer.classList.add("open");
        isOpen = true;
        isPetalLooping = true;
        launchPetalsLoop();
        setTimeout(() => {
          envelope.classList.add("animate-slide-down-out");
          flap.style.transition = "none"; // √©vite le saut sur Safari
          flap.classList.add("flap-slide-down");
          setTimeout(() => {
            flap.style.transition = "transform 0.7s cubic-bezier(0.77, 0, 0.18, 1)";
          }, 1000); // remet la transition apr√®s animation
        }, 700);
      };

      /**
       * Handles keyboard accessibility for opening the envelope.
       * @param {KeyboardEvent} event
       */
      const handleEnvelopeKeyDown = (event) => {
        if (isOpen) return;
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          handleOpenEnvelope();
        }
      };

      envelopeContainer.addEventListener("click", handleOpenEnvelope);
      envelopeContainer.addEventListener("keydown", handleEnvelopeKeyDown);

      // Observe envelope open state to animate flap
      let lastClass = envelopeContainer.className;

      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === "class") {
            const currentClass = envelopeContainer.className;
            if (currentClass !== lastClass) {
              const isOpenClass = currentClass.includes("open");
              if (isOpenClass && !flap.classList.contains("flap-slide-down")) {
                flap.style.transform = "rotateX(-140deg)";
                flap.style.transitionDelay = "0s";
              } else {
                flap.style.transform = "rotateX(0deg)";
                flap.style.transitionDelay = "";
              }
              lastClass = currentClass;
            }
          }
        });
      });

      observer.observe(envelopeContainer, {
        attributes: true,
        attributeFilter: ["class"],
      });

      /**
       * Renders the guest list from the URL parameter "invitation".
       * Handles formatting for 1, 2, or more guests.
       */
      const renderGuestList = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const invitationParam = urlParams.get("invitation");
        const guestsList = document.getElementById("guests-list");
        const invitationBlock = document.getElementById("invitation-block");

        if (!invitationParam) {
          invitationBlock.style.display = "none";
          return;
        }

        const guests = invitationParam
          .split(",")
          .map((name) => name.trim())
          .filter(Boolean);

        if (guests.length === 0) {
          invitationBlock.style.display = "none";
          return;
        }

        guestsList.innerHTML = guests
          .map((guest, idx) => {
            if (guests.length === 1) {
              return `<span class="inline font-medium text-[#CE412D]">${guest}</span>`;
            } else if (idx === guests.length - 1) {
              return `<span class="inline font-medium text-[#CE412D]">et ${guest}</span>`;
            } else if (idx === guests.length - 2) {
              return `<span class="inline font-medium text-[#CE412D]">${guest} </span>`;
            } else {
              return `<span class="inline font-medium text-[#CE412D]">${guest}, </span>`;
            }
          })
          .join("");
        invitationBlock.style.display = "";
      };

      // Initial rendering and automatic envelope opening after 2 seconds
      renderGuestList();
      setTimeout(() => {
        handleOpenEnvelope();
      }, 2000);
    </script>
  </body>
</html>
